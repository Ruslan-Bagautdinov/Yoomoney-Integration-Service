# Yoomoney Integration Service

## Overview

The Yoomoney Integration Service is a FastAPI-based application designed to automate the process of registering Yoomoney applications for users and integrating these apps into the payment system. This service provides a set of RESTful APIs to interact with Yoomoney and manage payment operations.

## Features

- **Register Yoomoney Applications**: Automate the registration process for Yoomoney applications.
- **Request Authorization**: Request authorization from Yoomoney to access user accounts.
- **Receive Authorization Code**: Handle the callback from Yoomoney to receive the authorization code.
- **Create Payments**: Create payments using Yoomoney's Quickpay service.
- **Check Payment Status**: Check the status of payments made through Yoomoney.

## Installation

This setup provides a comprehensive guide to install, configure, and use the Yoomoney Integration Service.

### Prerequisites

- Python 3.7+
- pip
- Yoomoney API credentials

### Steps

1. **Clone the Repository**

    ```bash
    git clone https://github.com/yourusername/yoomoney-integration-service.git
    cd yoomoney-integration-service
    ```

2. **Set Up a Virtual Environment**

    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows use `venv\Scripts\activate`
    ```

3. **Install Dependencies**

    ```bash
    pip install -r requirements.txt
    ```

4. **Configure Environment Variables**

    Create a `.env` file in the root directory with the following content:

    ```env
    YM_REDIRECT_URI_BASE=https://api.terrapay.online
    YM_REDIRECT_ENDPOINT=/yoomoney_callback/
    ```

5. **Run the Application**

    ```bash
    uvicorn main:app --reload
    ```

    The application will be available at `http://localhost:8000`.

## API Documentation

The API documentation is automatically generated by FastAPI and can be accessed at `http://localhost:8000/docs` or `http://localhost:8000/redoc`.

## Usage

### Register Yoomoney Application

To start the registration process, send a GET request to `/register_start/` with the following JSON payload:

```json
{
  "user_id": "your_user_id"
}
```

To end the registration process, send a POST request to /register_end/ with the following JSON payload:

```json
{
  "user_id": "your_user_id",
  "client_id": "your_client_id"
}
```

### Request Authorization
To request authorization from Yoomoney, send a POST request to /request_authorization/ with the following JSON payload:

```json
{
  "user_id": "your_user_id",
  "client_id": "your_client_id"
}
```

### Receive Authorization Code
Yoomoney will redirect the user to the callback URL with the authorization code. The application will handle this callback and exchange the code for an access token.

```json
{
  "receiver": "your_receiver",
  "targets": "your_targets",
  "sum": 100.0,
  "label": "your_label"
}
```

### Check Payment Status
To check the status of a payment, send a POST request to /check_payment_status/ with the following JSON payload:

```json
{
  "access_token": "your_access_token",
  "payment_id": "your_payment_id"
}
```

### Contributing
Contributions are welcome! Please read the contributing guidelines before getting started.

### License
This project is licensed under the MIT License. See the LICENSE file for details.

### Contact
For any inquiries, please open an issue or contact the maintainers directly.

Thank you for using the Yoomoney Integration Service!
